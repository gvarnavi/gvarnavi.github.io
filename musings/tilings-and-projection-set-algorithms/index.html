<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction As part of my postdoctoral Miller fellowship, I have been developing computational imaging algorithms to recover the phase of an object from diffraction intensity measurements, using a technique called &ldquo;electron ptychography&rdquo;. One of the earliest and most successful algorithms for such phase retrieval is based on projection onto (non-)convex sets, which turns out to also be able to solve a variety of non-convex problems. Perhaps the most fun application is solving a Sudoku puzzle."><meta name=theme-color content="#decbe4ff"><meta property="og:title" content="Tilings and Projection Set Algorithms • Georgios Varnavides"><meta property="og:description" content="Introduction As part of my postdoctoral Miller fellowship, I have been developing computational imaging algorithms to recover the phase of an object from diffraction intensity measurements, using a technique called &ldquo;electron ptychography&rdquo;. One of the earliest and most successful algorithms for such phase retrieval is based on projection onto (non-)convex sets, which turns out to also be able to solve a variety of non-convex problems. Perhaps the most fun application is solving a Sudoku puzzle."><meta property="og:url" content="https://gvarnavi.github.io/musings/tilings-and-projection-set-algorithms/"><meta property="og:site_name" content="Georgios Varnavides"><meta property="og:type" content="article"><meta property="og:image" content="https://www.gravatar.com/avatar/aceac9054540f7b460086cbe195d1d03?s=256"><meta property="article:section" content="musings"><meta property="article:published_time" content="2023-02-02T14:00:00+06:00"><meta property="article:modified_time" content="2023-02-02T14:00:00+06:00"><meta name=twitter:card content="summary"><meta name=generator content="Hugo 0.120.3"><title>Tilings and Projection Set Algorithms • Georgios Varnavides</title>
<link rel=canonical href=https://gvarnavi.github.io/musings/tilings-and-projection-set-algorithms/><link rel=icon href=/favicon.ico><link rel=stylesheet href=/assets/css/main.ab98e12b.css><link rel=stylesheet href=/css/custom.css><style>:root{--color-accent:#decbe4ff}</style></head><body class='page type-musings has-sidebar'><div class=site><div id=sidebar class=sidebar><a class=screen-reader-text href=#main-menu>Skip to Main Menu</a><div class=container><section class='widget widget-about sep-after'><header><div class=logo><a href=/><img src=/images/headshot.png></a></div><h2 class='title site-title'><a href=/>Georgios Varnavides</a></h2><div class=desc>Researcher | Aspiring cat herder</div></header></section><section class='widget widget-search sep-after'><header><h4 class='title widget-title'></h4></header><form action=/search id=search-form class=search-form><label><span class=screen-reader-text>Search</span>
<input id=search-term class=search-term type=search name=q placeholder=Search&mldr;></label></form></section><section class='widget widget-sidebar_menu sep-after'><nav id=sidebar-menu class='menu sidebar-menu' aria-label='Sidebar Menu'><div class=container><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/research-topics/>Research</a></li><li class=item><a href=/publications/>Publications</a></li><li class=item><a href=/presentations/>Presentations</a></li><li class='item has-current'><a href=/musings/>Musings</a></li><li class=item><a href=/about/>About</a></li></ul></div></nav></section><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=https://github.com/gvarnavi target=_blank rel='noopener me'><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/g_varnavides target=_blank rel='noopener me'><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:gvarnavides@berkeley.edu target=_blank rel='noopener me'><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href='https://scholar.google.com/citations?user=zWvoz5YAAAAJ' target=_blank rel='noopener me'><span class=screen-reader-text>Open Google_scholar account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M12 24a7 7 0 110-14 7 7 0 010 14zm0-24L0 9.5l4.838 3.94A8 8 0 0112 9a8 8 0 017.162 4.44L24 9.5z"/></svg></a></li></ul></nav></section></div><div class=sidebar-overlay></div></div><div class=main><nav id=main-menu class='menu main-menu' aria-label='Main Menu'><div class=container><a class=screen-reader-text href=#content>Skip to Content</a>
<button id=sidebar-toggler class=sidebar-toggler aria-controls=sidebar>
<span class=screen-reader-text>Toggle Sidebar</span>
<span class=open><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></span><span class=close><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></span></button><ul><li class=item><a href=/>Home</a></li><li class=item><a href=/research-topics/>Research</a></li><li class=item><a href=/presentations/>Presentations</a></li><li class='item current'><a aria-current=page href=/musings/>Musings</a></li><li class=item><a href=/about/>About</a></li></ul></div></nav><div class=header-widgets><div class=container><style>.widget-breadcrumbs li:after{content:'\2f '}</style><section class='widget widget-breadcrumbs sep-after'><nav id=breadcrumbs><ol><li><a href=/>Home</a></li><li><a href=/musings/>Musings</a></li><li><span>Tilings and Projection Set Algorithms</span></li></ol></nav></section></div></div><header id=header class='header site-header'><div class='container sep-after'><div class=header-info><p class='site-title title'>Georgios Varnavides</p><p class='desc site-desc'>Researcher | Aspiring cat herder</p></div></div></header><main id=content><article lang=en class=entry><header class='header entry-header'><div class='container sep-after'><div class=header-info><h1 class=title>Tilings and Projection Set Algorithms</h1></div><div class=entry-meta><span class=posted-on><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg><span class=screen-reader-text>Posted on </span><time class=entry-date datetime=2023-02-02T14:00:00+06:00>2023, Feb 02</time>
</span><span class=byline><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M21 21V20c0-2.76-4-5-9-5s-9 2.24-9 5v1"/><path d="M16 6.37A4 4 0 1112.63 3 4 4 0 0116 6.37z"/></svg><span class=screen-reader-text>by </span><a href=/authors/georgiosvarnavides>Georgios Varnavides</a></span>
<span class=reading-time><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 15 15"/></svg>4 mins read</span></div></div></header><div class='container entry-content'><h1 id=introduction>Introduction</h1><p>As part of my postdoctoral Miller fellowship, I have been developing <a href=https://github.com/py4dstem/py4DSTEM/pull/375>computational imaging algorithms</a> to recover the phase of an object from diffraction intensity measurements, using a technique called &ldquo;electron ptychography&rdquo;.
One of the earliest and most successful algorithms for such phase retrieval is based on projection onto (non-)convex sets, which turns out to also be able to solve a variety of non-convex problems.
Perhaps the most fun application is solving a Sudoku puzzle.</p><h2 id=sudoku-puzzles>Sudoku Puzzles</h2><p>Sudoku puzzles can be viewed as a constraint satisfaction problem, with the following well-known constraints:</p><ul><li>Each row contains only one of each of the numbers 1-9</li><li>Each column contains only one of each of the numbers 1-9</li><li>Each 3x3 &lsquo;block&rsquo; contains only one of each of the numbers 1-9</li><li>The solution must be consistent with a (minimum) set of pre-defined grid numbers</li></ul><p>If we represent a Sudoku grid using a binary 9x9x9 array, where if the element \(
Q\left(i,j,k \right) \) is equal to 1, then we place the number \(
k \) on the \(
\left(i,j\right) \) tile, then we can formalize these constraints as:</p><p>\[
\begin{align}
\sum_{k=1}^9 Q(i,j,k) &= 1 \quad \forall i,j \\
    \sum_{i=1}^9 Q(i,j,k) &= 1 \quad \forall j,k \\
    \sum_{j=1}^9 Q(i,j,k) &= 1 \quad \forall i,k \\
    \sum_{i=1}^3 \sum_{j=1}^3 Q(i+U,j+V,k) &= 1 \quad \forall k \text{ and } \; U,V \in \left\{ 0,3,6 \right \} \\
Q(i,j,:) &= \gamma_{i,j} \quad \forall i,j \in J',
\end{align}
\]<br>where \(
\gamma_{i,j} \) is the unit-vector representing the known symbols in \(
J'\).
Note that the first constraint, namely that the sum over the vector of symbols must equal 1 for each tile, combined with the fact that our representation only allows binary values of 0 or 1, ensures we have a single symbol at each cell.</p><p>As formulated above, the problem lends itself well to Linear Programming solutions, e.g. the <a href=https://resources.wolframcloud.com/FunctionRepository/resources/SolveSudokuPuzzle>SolveSudokuPuzzle</a> resource function, which has the minimal source code:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mathematica data-lang=mathematica><span style=display:flex><span>SolveSudokuPuzzle[<span style=color:#bb60d5>known_SparseArray</span>]<span style=color:#bbb> </span><span style=color:#666>:=</span><span style=color:#bbb> </span>Module[{z,sudokuConstraints,vars,knownConstraints,res,i,j,k,l,n,m<span style=color:#666>=</span>Length[known]},<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>n<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>Sqrt[m];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>sudokuConstraints<span style=color:#666>=</span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>Table[{Total[z[i,j]]<span style=color:#666>==</span><span style=color:#40a070>1</span>,<span style=color:#40a070>0</span><span>\</span>[VectorLessEqual]z[i,j]<span>\</span>[VectorLessEqual]<span style=color:#40a070>1</span>,z[i,j]<span>\</span>[Element]Vectors[m,Integers]},{i,m},{j,m}],<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>Table[{Sum[z[i,j],{j,m}]<span style=color:#666>==</span><span style=color:#40a070>1</span>,Sum[z[j,i],{j,m}]<span style=color:#666>==</span><span style=color:#40a070>1</span>},{i,m}],<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>Table[Sum[z[i<span style=color:#666>+</span>k,j<span style=color:#666>+</span>l],{k,m},{l,m}]<span style=color:#666>==</span><span style=color:#40a070>1</span>,{i,<span style=color:#40a070>0</span>,m<span style=color:#666>-</span>n,n},{j,<span style=color:#40a070>0</span>,m<span style=color:#666>-</span>n,n}]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>};<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>knownConstraints<span style=color:#666>=</span>MapThread[Indexed[z<span style=color:#666>@@</span><span style=color:#bb60d5>#1</span>,Abs[<span style=color:#bb60d5>#2</span>]]<span style=color:#666>==</span>If[<span style=color:#bb60d5>#2</span><span style=color:#666>&lt;</span><span style=color:#40a070>0</span>,<span style=color:#40a070>0</span>,<span style=color:#40a070>1</span>]<span style=color:#666>&amp;</span>,{known[<span style=color:#4070a0>&#34;NonzeroPositions&#34;</span>],known[<span style=color:#4070a0>&#34;NonzeroValues&#34;</span>]}];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>vars<span style=color:#666>=</span>Flatten[Table[z[i,j],{i,m},{j,m}]];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>LinearOptimization[<span style=color:#40a070>0</span>,{sudokuConstraints,knownConstraints},vars]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p>Back to projection set algorithms, <a href=https://www.pnas.org/doi/10.1073/pnas.0606359104>Veit Elser and co-authors showed</a> that the Sudoku constraints can be interpreted as projection operators to appropriate non-convex sets and solved using a specific projection set algorithm called the <a href="https://opg.optica.org/viewmedia.cfm?r=1&amp;rwjcode=josaa&amp;uri=josaa-20-1-40&amp;html=true">&ldquo;difference map&rdquo;</a> algorithm.
We will skip most of the implementation details, but as an example the single-symbol constraint for each tile can be implemented as a projection operator which sets the maximum-value index to 1 and the rest of the elements of the vector to zero, i.e.:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mathematica data-lang=mathematica><span style=display:flex><span>projectToUnitVector[<span style=color:#bb60d5>vector_</span>]<span style=color:#666>:=</span>UnitVector[<span style=color:#40a070>9</span>,First<span style=color:#666>@</span>FirstPosition[vector,Max[vector],{<span style=color:#40a070>1</span>},Heads<span style=color:#666>-&gt;</span>False]]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>squareProjection[<span style=color:#bb60d5>array_</span>]<span style=color:#666>:=</span>Map[projectToUnitVector,array,{<span style=color:#40a070>2</span>}]<span style=color:#bbb>
</span></span></span></code></pre></div><p>Here&rsquo;s a fun <a href=https://barisdemiroz.github.io/sudoku/sudokusolver_demo.html>online demo</a> of the projection sets algorithm at work solving Sudoku puzzles.
For more information, see this wonderfully-clear <a href=https://open.library.ubc.ca/soa/cIRcle/collections/ubctheses/24/items/1.0071292>thesis</a> on the topic.</p><h2 id=constrained-tilings>Constrained Tilings</h2><p>Considering the sets satisfying the above 5 constraints are highly non-convex, I was curious to see if projection set algorithms could solve another favorite problem of mine which can be formulated using linear constraints, namely that of <a href=https://community.wolfram.com/groups/-/m/t/2135869>constrained tilings</a>.</p><p>The problem is formulated as follows: given an \(
\left(n,m\right) \) target image, and a set of \(
L \) (colored) tiles, find the arrangement of tiles which most closely approximates the target image&rsquo;s color values, while respecting the topological constraints between adjacent tiles.
For example, in the set of 24 grayscale &ldquo;Smith&rdquo; tiles shown below, the tiles in the first two rows in the third column are allowed to be placed on top of each other, but the tiles in the first two rows of the first column are not.</p><figure><img src=/images/musings-05-smith-tiles.png></figure><p>For the sake of brevity, we once again omit most implementation details, but briefly the projections are given by:</p><ul><li>Similar to the Sudoku puzzles, we represent our tiling using an \(
\left(n,m,L\right) \) array and only allow one tile per pixel.
As such, the first constraint and thus projection operator is the same as above.</li><li>The target-image-constistency constraint we choose is also fairly straightforward: we simply weigh the current iteration vector at each pixel according to a Gaussian kernel centered on the tile&rsquo;s color value minus the target image color value at that pixel.</li><li>The tiling constraint projection is perhaps less obvious.
Denote the set of \(
M \) topological constraints acting on a vectorized version of our array \(
\vec{x} = \text{vec}\left(Q(i,j,t)\right) \), using the \(
\left(M,n \times m \times L\right) \) matrix \(
C \), such that \(
C \cdot \vec{x} = 0 \).
The <a href=https://en.wikipedia.org/wiki/Moore%E2%80%93Penrose_inverse#Projectors>orthogonal projector</a> onto the nullspace of the topological constraints is therefore given by:
\[
P_{C}(\vec{x}) = \left(\mathbb{I} - C^+\cdot C \right)\cdot \vec{x},
\]
where \(
C^+ \) denotes the Moore-Penrose pseudoinverse of the topological constraints matrix.</li></ul><p>We implement these three projections using the <a href=https://epubs.siam.org/doi/abs/10.1137/18M1170364>&ldquo;relax-reflect-reflect&rdquo;</a> algorithm (a variant of the &ldquo;difference-map&rdquo; algorithm, with a tunable step-size) and, lo and behold, it works!</p><figure><img src=/images/musings-05-smith-tiles-obama.gif></figure><p>I hope you find watching the algorithm trying to climb out of a local minimum as mesmerizing as I do!
If you are curious about the source code, here is a <a href=https://www.wolframcloud.com/obj/gvarnavi/Published/constrained-tilings-projection-set-algorithms.nb>cloud notebook</a>.</p></div><footer class=entry-footer><div class='container sep-before'></div></footer></article><nav class=entry-nav><div class=container><div class='prev-entry sep-before'><a href=/musings/counting-digits-of-pi/><span aria-hidden=true><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><line x1="20" y1="12" x2="4" y2="12"/><polyline points="10 18 4 12 10 6"/></svg>Previous</span>
<span class=screen-reader-text>Previous post: </span>Counting Digits of Pi</a></div></div></nav><section id=comments class=comments><div class='container sep-before'><div class=comments-area><script src=https://utteranc.es/client.js repo=gvarnavi/personal-website-content issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></section></main><footer id=footer class=footer><div class='container sep-before'><section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'><ul><li><a href=https://github.com/gvarnavi target=_blank rel='noopener me'><span class=screen-reader-text>Open Github account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></li><li><a href=https://twitter.com/g_varnavides target=_blank rel='noopener me'><span class=screen-reader-text>Open Twitter account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a></li><li><a href=mailto:gvarnavides@berkeley.edu target=_blank rel='noopener me'><span class=screen-reader-text>Contact via Email</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href='https://scholar.google.com/citations?user=zWvoz5YAAAAJ' target=_blank rel='noopener me'><span class=screen-reader-text>Open Google_scholar account in new tab</span><svg class="icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M12 24a7 7 0 110-14 7 7 0 010 14zm0-24L0 9.5l4.838 3.94A8 8 0 0112 9a8 8 0 017.162 4.44L24 9.5z"/></svg></a></li></ul></nav></section><div class=copyright><p>&copy; 2021-2023 Georgios Varnavides</p></div></div></footer></div></div><script>window.__assets_js_src="/assets/js/"</script><script src=/assets/js/main.c3bcf2df.js></script><script src=/js/custom.js></script><link rel=stylesheet href=//unpkg.com/katex/dist/katex.min.css><script src=//unpkg.com/katex/dist/katex.min.js></script><script src=//unpkg.com/katex/dist/contrib/auto-render.min.js></script><script type=text/javascript>renderMathInElement(document.querySelector(".entry-content"),{})</script></body></html>